22s
Run #!/usr/bin/env bash
  #!/usr/bin/env bash
  set +e
  cd talloc-2.4.2
  
  # --- Function: auto-repair needed files/pkgs ---
  repair_file() {
    local filename="$1"
    local url="$2"
    if [ ! -f "$filename" ]; then
      echo "Восстанавливаем $filename из $url"
      wget "$url" -O "$filename"
      chmod +x "$filename" || true
    fi
  }
  
  # --- Function: ensure install dir and minimal structure ---
  ensure_install_dir() {
    if [ ! -d install ]; then
      echo "Создаём папку install"
      mkdir -p install/lib install/include
    fi
  }
  
  # --- Function: scan dir for critical files ---
  scan_critical_files() {
    echo "=== Файлы в $PWD ==="
    find . -type f \( -name 'waf*' -o -name 'configure' -o -name 'wscript' -o -name '*.c' -o -name '*.h' \)
  }
  
  # --- Step 1: Проверка и скачивание нужных файлов ---
  scan_critical_files | tee ../talloc_scan_step1.log
  
  repair_file "configure" "https://www.samba.org/ftp/talloc/talloc-2.4.2.tar.gz"
  if [ ! -f "waf-light" ]; then
    repair_file "waf-light" "https://www.samba.org/ftp/rsync/waf-light"
  fi
  
  # Если waf отсутствует, запускаем configure для генерации waf/waflib
  if [ ! -f "waf" ]; then
    if [ -f "configure" ]; then
      chmod +x configure
      ./configure || true
    fi
  fi
  
  # Если waf так и нет — качаем fallback waf
  if [ ! -f "waf" ]; then
    repair_file "waf" "https://waf.io/waf-2.0.25"
  fi
  
  # Если waflib нет — качаем и распаковываем waflib
  if [ ! -d "waflib" ]; then
    wget https://waf.io/waflib-2.0.25.zip -O waflib.zip
    unzip -q waflib.zip
    if [ -d waflib-2.0.25 ]; then mv waflib-2.0.25 waflib; fi
    if [ -d waflib ]; then echo "waflib восстановлен"; fi
  fi
  
  # --- Step 2: Удаление тестов и автопатчинг wscript ---
  echo "Удаляем тестовые исходники и патчим wscript" | tee ../talloc_patch.log
  find . -type f -name "test*.c" -delete || true
  find . -type d -name "test*" -exec rm -rf {} + || true
  if [ -f wscript ]; then
    sed -i '/def build_tests(ctx):/,/^$/d' wscript
    sed -i '/ctx\.recurse.*tests.*/d' wscript
    sed -i '/bld\.SAMBA_SUBSYSTEM.*tests.*/d' wscript
    sed -i '/tests\/Makefile/d' wscript
    sed -i '/tests = /d' wscript
    sed -i '/replace-test/d' wscript
    sed -i '/testsuite/d' wscript
    sed -i '/test_/d' wscript
  fi
  
  # --- Step 3: Сборка с автолечением ---
  export ANDROID_API=21
  export NDK_HOME="$HOME/android-ndk"
  export TOOLCHAIN="$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin"
  export SYSROOT="$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/sysroot"
  export CC="$TOOLCHAIN/aarch64-linux-android$ANDROID_API-clang"
  export AR="$TOOLCHAIN/llvm-ar"
  export RANLIB="$TOOLCHAIN/llvm-ranlib"
  export CFLAGS="--target=aarch64-linux-android$ANDROID_API --sysroot=$SYSROOT -fPIC -DANDROID -Wno-deprecated-declarations"
  export LDFLAGS="--target=aarch64-linux-android$ANDROID_API --sysroot=$SYSROOT -fPIC"
  
  ensure_install_dir
  
  build_ok=0
  for attempt in {1..3}; do
    echo "Попытка сборки talloc $attempt..." | tee -a ../talloc_build.log
    chmod +x waf
    ./waf configure \
      --disable-python \
      --without-gettext \
      --prefix=$PWD/install \
      CC="$CC" AR="$AR" RANLIB="$RANLIB" CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" 2>&1 | tee -a ../talloc_build.log
    ./waf build -v 2>&1 | tee -a ../talloc_build.log
    ./waf install 2>&1 | tee -a ../talloc_build.log
    # --- Проверяем наличие результата ---
    if [ -f install/lib/libtalloc.a ] || [ -f install/lib64/libtalloc.a ] || [ -d install ]; then
      echo "talloc успешно собран!"
      build_ok=1
      break
    else
      echo "Сборка не удалась, пробуем долечить..." | tee -a ../talloc_build.log
      scan_critical_files | tee -a ../talloc_build.log
      ensure_install_dir
      # если waflib или waf исчезли — восстанавливаем снова
      if [ ! -f waf ]; then repair_file "waf" "https://waf.io/waf-2.0.25"; fi
      if [ ! -d waflib ]; then
        wget https://waf.io/waflib-2.0.25.zip -O waflib.zip
        unzip -q waflib.zip
        if [ -d waflib-2.0.25 ]; then mv waflib-2.0.25 waflib; fi
      fi
      # если configure исчез — снова тянем tarball
      if [ ! -f configure ]; then wget https://www.samba.org/ftp/talloc/talloc-2.4.2.tar.gz -O talloc-repair.tar.gz; tar -xf talloc-repair.tar.gz --strip-components=1; fi
      # если install/lib нет — создаём
      ensure_install_dir
    fi
  done
  if [ $build_ok -ne 1 ]; then
    echo "Не удалось собрать talloc после 3 попыток, завершаем с ошибкой."
    scan_critical_files | tee -a ../talloc_build.log
    exit 1
  fi
  shell: /usr/bin/bash -e {0}
  env:
    ANDROID_NDK_HOME: /home/runner/android-ndk
    PATH: /home/runner/android-ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:/snap/bin:/home/runner/.local/bin:/opt/pipx_bin:/home/runner/.cargo/bin:/home/runner/.config/composer/vendor/bin:/usr/local/.ghcup/bin:/home/runner/.dotnet/tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
=== Файлы в /home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2 ===
./test_pytalloc.c
./pytalloc.c
./talloc.h
./pytalloc_private.h
./buildtools/bin/waf
./buildtools/wafsamba/wscript
./buildtools/wafsamba/wafsamba.py
./talloc.c
./test_magic_differs_helper.c
./wscript
./testsuite.c
./lib/replace/xattr.c
./lib/replace/socket.c
./lib/replace/tests/shared_mmap.c
./lib/replace/tests/os2_delete.c
./lib/replace/tests/incoherent_mmap.c
./lib/replace/tests/snprintf.c
./lib/replace/tests/getifaddrs.c
./lib/replace/tests/strptime.c
./lib/replace/tests/testsuite.c
./lib/replace/tests/shared_mremap.c
./lib/replace/tests/main.c
./lib/replace/system/filesys.h
./lib/replace/system/shmem.h
./lib/replace/system/capability.h
./lib/replace/system/glob.h
./lib/replace/system/kerberos.h
./lib/replace/system/locale.h
./lib/replace/system/readline.h
./lib/replace/system/select.h
./lib/replace/system/dir.h
./lib/replace/system/syslog.h
./lib/replace/system/time.h
./lib/replace/system/terminal.h
./lib/replace/system/threads.h
./lib/replace/system/gssapi.h
./lib/replace/system/python.h
./lib/replace/system/wait.h
./lib/replace/system/passwd.h
./lib/replace/system/network.h
./lib/replace/system/iconv.h
./lib/replace/dlfcn.c
./lib/replace/socketpair.c
./lib/replace/snprintf.c
./lib/replace/getifaddrs.c
./lib/replace/strptime.c
./lib/replace/inet_ntop.c
./lib/replace/getaddrinfo.c
./lib/replace/wscript
./lib/replace/closefrom.c
./lib/replace/getaddrinfo.h
./lib/replace/hdr_replace.h
./lib/replace/replace-testsuite.h
./lib/replace/configure
./lib/replace/replace.c
./lib/replace/inet_pton.c
./lib/replace/inet_aton.c
./lib/replace/replace-test.h
./lib/replace/replace.h
./lib/replace/win32_replace.h
./lib/replace/timegm.c
./lib/replace/inet_ntoa.c
./lib/replace/poll.c
./configure
./compat/talloc_compat1.c
./testsuite_main.c
./third_party/waf/waflib/Tools/waf_unit_test.py
./third_party/waf/waflib/extras/wafcache.py
./third_party/waf/waflib/extras/waf_xattr.py
./talloc_testsuite.h
./pytalloc.h
./pytalloc_util.c
Восстанавливаем waf-light из https://www.samba.org/ftp/rsync/waf-light
--2025-05-24 06:02:50--  https://www.samba.org/ftp/rsync/waf-light
Resolving www.samba.org (www.samba.org)... 144.76.82.148, 2a01:4f8:192:486::2:3
Connecting to www.samba.org (www.samba.org)|144.76.82.148|:443... connected.
HTTP request sent, awaiting response... 404 Not Found
2025-05-24 06:02:51 ERROR 404: Not Found.

Setting top to                           : /home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2 
Setting out to                           : /home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/bin 
Checking for 'gcc' (C compiler)          : /usr/bin/gcc 
Checking for program 'git'               : /usr/bin/git 
Checking for c flags '-MMD'              : yes 
Checking for program 'gdb'               : not found 
Checking for header sys/utsname.h        : yes 
Checking uname sysname type              : Linux 
Checking uname machine type              : x86_64 
Checking uname release type              : 6.8.0-1027-azure 
Checking uname version type              : #32~22.04.1-Ubuntu SMP Thu Apr  3 20:26:27 UTC 2025 
Checking for header stdio.h              : yes 
Checking simple C program                : ok 
Checking compiler accepts ['-Werror']    : yes 
Checking linker accepts ['-Wl,-rpath,.'] : yes 
Checking for rpath library support       : yes 
Checking for -Wl,--version-script support : yes 
Checking compiler accepts ['-fvisibility=hidden'] : yes 
Checking for HAVE_VISIBILITY_ATTR                 : ok 
Checking for library constructor support          : ok 
Checking for library destructor support           : ok 
Checking for __attribute__                        : ok 
Checking compiler accepts ['-fPIC']               : yes 
Checking for inline                               : inline 
Checking for program 'pkg-config'                 : /usr/bin/pkg-config 
Checking for pkg-config version >= '0.0.0'        : yes 
Checking compiler accepts ['-D__STDC_WANT_LIB_EXT1__=1'] : yes 
Checking compiler accepts ['']                           : yes 
Checking for header sys/types.h                          : yes 
Checking for header sys/stat.h                           : yes 
Checking for header stdlib.h                             : yes 
Checking for header stddef.h                             : yes 
Checking for header memory.h                             : yes 
Checking for header string.h                             : yes 
Checking for header strings.h                            : yes 
Checking for header inttypes.h                           : yes 
Checking for header stdint.h                             : yes 
Checking for header unistd.h                             : yes 
Checking for header minix/config.h                       : no 
Checking for header ctype.h                              : yes 
Checking for header standards.h                          : no 
Checking for header stdbool.h                            : yes 
Checking for header stdarg.h                             : yes 
Checking for header vararg.h                             : no 
Checking for header limits.h                             : yes 
Checking for header assert.h                             : yes 
Checking getconf LFS_CFLAGS                              : not found 
Checking getconf large file support flags work           : ok 
Checking for large file support without additional flags : ok 
Checking for header sys/time.h                           : yes 
Checking for header time.h                               : yes 
Checking for header endian.h                             : yes 
Checking for header sys/endian.h                         : no 
Checking for HAVE_LITTLE_ENDIAN                          : ok 
Checking for HAVE_BIG_ENDIAN                             : not found 
Checking for header signal.h                             : yes 
Checking if signal handlers return int                   : not found 
Checking for variable __FUNCTION__                       : ok 
Checking for va_copy                                     : ok 
Checking for header linux/types.h                        : yes 
Checking for header crypt.h                              : yes 
Checking for header locale.h                             : yes 
Checking for header acl/libacl.h                         : no 
Checking for header compat.h                             : no 
Checking for header attr/xattr.h                         : no 
Checking for header dustat.h                             : no 
Checking for header fcntl.h                              : yes 
Checking for header fnmatch.h                            : yes 
Checking for header glob.h                               : yes 
Checking for header history.h                            : no 
Checking for header krb5.h                               : no 
Checking for header langinfo.h                           : yes 
Checking for header ndir.h                               : no 
Checking for header pwd.h                                : yes 
Checking for header shadow.h                             : yes 
Checking for header sys/acl.h                            : no 
Checking for header sys/attributes.h                     : no 
Checking for header attr/attributes.h                    : no 
Checking for header sys/capability.h                     : no 
Checking for header sys/dir.h                            : yes 
Checking for header sys/epoll.h                          : yes 
Checking for header sys/fcntl.h                          : yes 
Checking for header sys/filio.h                          : no 
Checking for header sys/filsys.h                         : no 
Checking for header sys/fs/s5param.h                     : no 
Checking for header sys/id.h                             : no 
Checking for header sys/ioctl.h                          : yes 
Checking for header sys/ipc.h                            : yes 
Checking for header sys/mman.h                           : yes 
Checking for header sys/mode.h                           : no 
Checking for header sys/ndir.h                           : no 
Checking for header sys/priv.h                           : no 
Checking for header sys/resource.h                       : yes 
Checking for header sys/security.h                       : no 
Checking for header sys/shm.h                            : yes 
Checking for header sys/statfs.h                         : yes 
Checking for header sys/statvfs.h                        : yes 
Checking for header sys/termio.h                         : no 
Checking for header sys/vfs.h                            : yes 
Checking for header sys/xattr.h                          : yes 
Checking for header termio.h                             : yes 
Checking for header termios.h                            : yes 
Checking for header sys/file.h                           : yes 
Checking for header sys/ucontext.h                       : yes 
Checking for header sys/wait.h                           : yes 
Checking for declaration of malloc                       : ok 
Checking for header grp.h                                : yes 
Checking for header sys/select.h                         : yes 
Checking for header setjmp.h                             : yes 
Checking for header utime.h                              : yes 
Checking for header sys/syslog.h                         : yes 
Checking for header syslog.h                             : yes 
Checking for header sys/mount.h                          : yes 
Checking for header mntent.h                             : yes 
Checking for header stropts.h                            : no 
Checking for header unix.h                               : no 
Checking for header sys/param.h                          : yes 
Checking for header sys/socket.h                         : yes 
Checking for header netinet/in.h                         : yes 
Checking for header netdb.h                              : yes 
Checking for header arpa/inet.h                          : yes 
Checking for header netinet/in_systm.h                   : yes 
Checking for header netinet/ip.h                         : yes 
Checking for header netinet/tcp.h                        : yes 
Checking for header netinet/in_ip.h                      : no 
Checking for header sys/sockio.h                         : no 
Checking for header sys/un.h                             : yes 
Checking for header sys/uio.h                            : yes 
Checking for header ifaddrs.h                            : yes 
Checking for header direct.h                             : no 
Checking for header dirent.h                             : yes 
Checking for header windows.h                            : no 
Checking for header winsock2.h                           : no 
Checking for header ws2tcpip.h                           : no 
Checking for header errno.h                              : yes 
Checking for header getopt.h                             : yes 
Checking for header iconv.h                              : yes 
Checking for header nss.h                                : yes 
Checking for header sasl/sasl.h                          : no 
Checking for header linux/openat2.h                      : yes 
Checking for inotify_init                                : ok 
Checking for header security/pam_appl.h                  : no 
Checking for header zlib.h                               : yes 
Checking for header asm/unistd.h                         : yes 
Checking for header sys/unistd.h                         : yes 
Checking for header alloca.h                             : yes 
Checking for header float.h                              : yes 
Checking for header rpc/rpc.h                            : no 
Checking for header rpc/nettype.h                        : no 
Checking for tirpc rpc headers in default system path    : not found 
Checking for libtirpc headers                            : yes 
Checking for header rpc/rpc.h                            : yes 
Checking for header rpc/nettype.h                        : yes 
Checking for header sys/sysctl.h                         : not found 
Checking for header sys/fileio.h                         : no 
Checking for header sys/filesys.h                        : no 
Checking for header sys/dustat.h                         : no 
Checking for header sys/sysmacros.h                      : yes 
Checking for header xfs/libxfs.h                         : no 
Checking for header netgroup.h                           : no 
Checking for header valgrind.h                           : no 
Checking for header valgrind/valgrind.h                  : no 
Checking for header valgrind/memcheck.h                  : no 
Checking for header valgrind/helgrind.h                  : no 
Checking for header valgrind/callgrind.h                 : no 
Checking for header nss_common.h                         : no 
Checking for header nsswitch.h                           : no 
Checking for header ns_api.h                             : no 
Checking for header sys/extattr.h                        : no 
Checking for header sys/ea.h                             : no 
Checking for header sys/proplist.h                       : no 
Checking for header sys/cdefs.h                          : yes 
Checking for header utmp.h                               : yes 
Checking for header utmpx.h                              : yes 
Checking for header lastlog.h                            : yes 
Checking for header syscall.h                            : yes 
Checking for header sys/syscall.h                        : yes 
Checking for header sys/atomic.h                         : no 
Checking for header stdatomic.h                          : yes 
Checking for header libgen.h                             : yes 
Checking compiler accepts -Wno-format-truncation         : yes 
Checking compiler accepts -Wno-unused-function           : yes 
Checking compiler accepts -Wno-strict-overflow           : yes 
Checking compiler accepts -Wno-unused-but-set-variable   : yes 
Checking compiler accepts -Wuse-after-free=1             : no 
Checking for header sys/prctl.h                          : yes 
Checking for prctl syscall                               : ok 
Checking for O_DIRECT flag to open(2)                    : ok 
Checking for long long                                   : ok 
Checking for intptr_t                                    : ok 
Checking for uintptr_t                                   : ok 
Checking for ptrdiff_t                                   : ok 
Checking for comparison_fn_t                             : ok 
Checking for bool                                        : ok 
Checking for int8_t                                      : ok 
Checking for uint8_t                                     : ok 
Checking for int16_t                                     : ok 
Checking for uint16_t                                    : ok 
Checking for int32_t                                     : ok 
Checking for uint32_t                                    : ok 
Checking for int64_t                                     : ok 
Checking for uint64_t                                    : ok 
Checking for size_t                                      : ok 
Checking for ssize_t                                     : ok 
Checking for ino_t                                       : ok 
Checking for loff_t                                      : ok 
Checking for offset_t                                    : not found 
Checking for volatile int                                : ok 
Checking for uint_t                                      : not found 
Checking for blksize_t                                   : ok 
Checking for blkcnt_t                                    : ok 
Checking if size of bool == 1                            : ok 
Checking if size of char == 1                            : ok 
Checking if size of int == 1                             : not found 
Checking if size of int == 2                             : not found 
Checking if size of int == 4                             : ok 
Checking if size of long long == 1                       : not found 
Checking if size of long long == 2                       : not found 
Checking if size of long long == 4                       : not found 
Checking if size of long long == 8                       : ok 
Checking if size of long == 1                            : not found 
Checking if size of long == 2                            : not found 
Checking if size of long == 4                            : not found 
Checking if size of long == 8                            : ok 
Checking if size of short == 1                           : not found 
Checking if size of short == 2                           : ok 
Checking if size of size_t == 1                          : not found 
Checking if size of size_t == 2                          : not found 
Checking if size of size_t == 4                          : not found 
Checking if size of size_t == 8                          : ok 
Checking if size of ssize_t == 1                         : not found 
Checking if size of ssize_t == 2                         : not found 
Checking if size of ssize_t == 4                         : not found 
Checking if size of ssize_t == 8                         : ok 
Checking if size of int8_t == 1                          : ok 
Checking if size of uint8_t == 1                         : ok 
Checking if size of int16_t == 1                         : not found 
Checking if size of int16_t == 2                         : ok 
Checking if size of uint16_t == 1                        : not found 
Checking if size of uint16_t == 2                        : ok 
Checking if size of int32_t == 1                         : not found 
Checking if size of int32_t == 2                         : not found 
Checking if size of int32_t == 4                         : ok 
Checking if size of uint32_t == 1                        : not found 
Checking if size of uint32_t == 2                        : not found 
Checking if size of uint32_t == 4                        : ok 
Checking if size of int64_t == 1                         : not found 
Checking if size of int64_t == 2                         : not found 
Checking if size of int64_t == 4                         : not found 
Checking if size of int64_t == 8                         : ok 
Checking if size of uint64_t == 1                        : not found 
Checking if size of uint64_t == 2                        : not found 
Checking if size of uint64_t == 4                        : not found 
Checking if size of uint64_t == 8                        : ok 
Checking if size of void* == 1                           : not found 
Checking if size of void* == 2                           : not found 
Checking if size of void* == 4                           : not found 
Checking if size of void* == 8                           : ok 
Checking if size of off_t == 1                           : not found 
Checking if size of off_t == 2                           : not found 
Checking if size of off_t == 4                           : not found 
Checking if size of off_t == 8                           : ok 
Checking if size of dev_t == 1                           : not found 
Checking if size of dev_t == 2                           : not found 
Checking if size of dev_t == 4                           : not found 
Checking if size of dev_t == 8                           : ok 
Checking if size of ino_t == 1                           : not found 
Checking if size of ino_t == 2                           : not found 
Checking if size of ino_t == 4                           : not found 
Checking if size of ino_t == 8                           : ok 
Checking if size of time_t == 1                          : not found 
Checking if size of time_t == 2                          : not found 
Checking if size of time_t == 4                          : not found 
Checking if size of time_t == 8                          : ok 
Checking for socklen_t                                   : ok 
Checking for struct ifaddrs                              : ok 
Checking for struct addrinfo                             : ok 
Checking for struct sockaddr                             : ok 
Checking for HAVE_STRUCT_SOCKADDR_IN6                    : ok 
Checking for struct sockaddr_storage                     : ok 
Checking for sa_family_t                                 : ok 
Checking for sig_atomic_t                                : ok 
Checking for sigsetmask                                  : ok 
Checking for siggetmask                                  : ok 
Checking for sigprocmask                                 : ok 
Checking for sigblock                                    : ok 
Checking for sigaction                                   : ok 
Checking for sigset                                      : ok 
Checking for inet_ntoa                                   : ok 
Checking for inet_aton                                   : ok 
Checking for inet_ntop                                   : ok 
Checking for inet_pton                                   : ok 
Checking for connect                                     : ok 
Checking for gethostbyname                               : ok 
Checking for getaddrinfo                                 : ok 
Checking for getnameinfo                                 : ok 
Checking for freeaddrinfo                                : ok 
Checking for gai_strerror                                : ok 
Checking for socketpair                                  : ok 
Checking for memset_s                                    : not found 
Checking for memset_explicit                             : not found 
Checking for volatile memory protection                  : ok 
Checking for variable IPV6_V6ONLY                        : ok 
Checking for header net/if.h                             : yes 
Checking for HAVE_IPV6                                   : ok 
Checking whether we have ucontext_t                      : ok 
Checking for __sync_fetch_and_add compiler builtin       : ok 
Checking for __sync_add_and_fetch compiler builtin       : ok 
Checking for atomic_add_32 compiler builtin              : not found 
Checking for __atomic_add_fetch compiler builtin         : ok 
Checking for __atomic_load compiler builtin              : ok 
Checking for atomic_thread_fence(memory_order_seq_cst) in stdatomic.h : ok 
Checking for fallthrough attribute                                    : ok 
Checking for strdup                                                   : ok 
Checking for memmem                                                   : ok 
Checking for printf                                                   : ok 
Checking for memset                                                   : ok 
Checking for memcpy                                                   : ok 
Checking for memmove                                                  : ok 
Checking for strcpy                                                   : ok 
Checking for strncpy                                                  : ok 
Checking for bzero                                                    : ok 
Checking for shl_load                                                 : not found 
Checking for shl_unload                                               : not found 
Checking for shl_findsym                                              : not found 
Checking for pipe                                                     : ok 
Checking for strftime                                                 : ok 
Checking for srandom                                                  : ok 
Checking for random                                                   : ok 
Checking for srand                                                    : ok 
Checking for rand                                                     : ok 
Checking for usleep                                                   : ok 
Checking for setbuffer                                                : ok 
Checking for lstat                                                    : ok 
Checking for getpgrp                                                  : ok 
Checking for utime                                                    : ok 
Checking for utimes                                                   : ok 
Checking for setuid                                                   : ok 
Checking for seteuid                                                  : ok 
Checking for setreuid                                                 : ok 
Checking for setresuid                                                : ok 
Checking for setgid                                                   : ok 
Checking for setegid                                                  : ok 
Checking for setregid                                                 : ok 
Checking for setresgid                                                : ok 
Checking for chroot                                                   : ok 
Checking for strerror                                                 : ok 
Checking for vsyslog                                                  : ok 
Checking for setlinebuf                                               : ok 
Checking for mktime                                                   : ok 
Checking for ftruncate                                                : ok 
Checking for chsize                                                   : not found 
Checking for rename                                                   : ok 
Checking for waitpid                                                  : ok 
Checking for wait4                                                    : ok 
Checking for initgroups                                               : ok 
Checking for pread                                                    : ok 
Checking for pwrite                                                   : ok 
Checking for strndup                                                  : ok 
Checking for strcasestr                                               : ok 
Checking for strsep                                                   : ok 
Checking for strtok_r                                                 : ok 
Checking for mkdtemp                                                  : ok 
Checking for dup2                                                     : ok 
Checking for dprintf                                                  : ok 
Checking for vdprintf                                                 : ok 
Checking for isatty                                                   : ok 
Checking for chown                                                    : ok 
Checking for lchown                                                   : ok 
Checking for link                                                     : ok 
Checking for readlink                                                 : ok 
Checking for symlink                                                  : ok 
Checking for realpath                                                 : ok 
Checking for snprintf                                                 : ok 
Checking for vsnprintf                                                : ok 
Checking for asprintf                                                 : ok 
Checking for vasprintf                                                : ok 
Checking for setenv                                                   : ok 
Checking for unsetenv                                                 : ok 
Checking for strnlen                                                  : ok 
Checking for strtoull                                                 : ok 
Checking for __strtoull                                               : not found 
Checking for strtouq                                                  : ok 
Checking for strtoll                                                  : ok 
Checking for __strtoll                                                : not found 
Checking for strtoq                                                   : ok 
Checking for memalign                                                 : ok 
Checking for posix_memalign                                           : ok 
Checking for fmemopen                                                 : ok 
Checking for header malloc.h                                          : yes 
Checking for declaration of memalign                                  : ok 
Checking for posix_fallocate-capable libc                             : ok 
Checking for posix_fallocate                                          : ok 
Checking for prctl                                                    : ok 
Checking for dirname                                                  : ok 
Checking for basename                                                 : ok 
Checking for strlcpy                                                  : not found 
Checking for strlcat                                                  : not found 
Checking for strlcpy                                                  : not found 
Checking for strlcat                                                  : not found 
Checking for library bsd                                              : no 
Checking for strlcpy                                                  : not found 
Checking for strlcat                                                  : not found 
Checking for getpeereid                                               : not found 
Checking for library bsd                                              : no 
Checking for getpeereid                                               : not found 
Checking for library setproctitle                                     : no 
Checking for setproctitle                                             : not found 
Checking for library bsd                                              : no 
Checking for setproctitle                                             : not found 
Checking for setproctitle_init                                        : not found 
Checking for library bsd                                              : no 
Checking for setproctitle_init                                        : not found 
Checking for closefrom                                                : ok 
Checking whether we can use SO_PEERCRED to get socket credentials     : ok 
Checking correct behavior of strtoll                                  : not found 
Checking for if_nameindex                                             : ok 
Checking for if_nametoindex                                           : ok 
Checking for strerror_r                                               : ok 
Checking for syslog                                                   : ok 
Checking for gai_strerror                                             : ok 
Checking for get_current_dir_name                                     : ok 
Checking for timegm                                                   : ok 
Checking for getifaddrs                                               : ok 
Checking for freeifaddrs                                              : ok 
Checking for mmap                                                     : ok 
Checking for setgroups                                                : ok 
Checking for syscall                                                  : ok 
Checking for setsid                                                   : ok 
Checking for getgrent_r                                               : ok 
Checking for getgrgid_r                                               : ok 
Checking for getgrnam_r                                               : ok 
Checking for getgrouplist                                             : ok 
Checking for getpagesize                                              : ok 
Checking for getpwent_r                                               : ok 
Checking for getpwnam_r                                               : ok 
Checking for getpwuid_r                                               : ok 
Checking for epoll_create1                                            : ok 
Checking for getprogname                                              : not found 
Checking for copy_file_range                                          : ok 
Checking for getxattr                                                 : ok 
Checking whether xattr interface takes additional options             : not found 
Checking for dlopen                                                   : ok 
Checking for dlsym                                                    : ok 
Checking for dlerror                                                  : ok 
Checking for dlclose                                                  : ok 
Checking for declaration of dlopen                                    : ok 
Checking C prototype for dlopen                                       : not found 
Checking for fdatasync                                                : ok 
Checking for declaration of fdatasync                                 : ok 
Checking for clock_gettime                                            : ok 
Checking whether the clock_gettime clock ID CLOCK_MONOTONIC is available : ok 
Checking whether the clock_gettime clock ID CLOCK_PROCESS_CPUTIME_ID is available : ok 
Checking whether the clock_gettime clock ID CLOCK_REALTIME is available           : ok 
Checking for struct timespec                                                      : ok 
Checking for header arpa/nameser.h                                                : yes 
Checking for header resolv.h                                                      : yes 
Checking for res_search                                                           : ok 
Checking for header libintl.h                                                     : yes 
Checking for library intl                                                         : no 
Checking for declaration of dgettext                                              : ok 
Checking for declaration of gettext                                               : ok 
Checking for declaration of bindtextdomain                                        : ok 
Checking for declaration of textdomain                                            : ok 
Checking for declaration of bind_textdomain_codeset                               : ok 
Checking for bindtextdomain                                                       : ok 
Checking for textdomain                                                           : ok 
Checking for bind_textdomain_codeset                                              : ok 
Checking for dgettext                                                             : ok 
Checking for gettext                                                              : ok 
Checking for pthread_create                                                       : ok 
Checking for pthread_attr_init                                                    : ok 
Checking for pthread_mutexattr_setrobust                                          : ok 
Checking for declaration of PTHREAD_MUTEX_ROBUST                                  : not found 
Checking for declaration of PTHREAD_MUTEX_ROBUST (as enum)                        : ok 
Checking for pthread_mutex_consistent                                             : ok 
Checking for __thread local storage                                               : ok 
Checking for crypt                                                                : not found 
Checking for library crypt                                                        : yes 
Checking for crypt in crypt                                                       : ok 
Checking for crypt_r                                                              : not found 
Checking for crypt_r in crypt                                                     : ok 
Checking for crypt_rn                                                             : not found 
Checking for crypt_rn in crypt                                                    : ok 
Checking for header readline.h                                                    : no 
Checking for header readline/readline.h                                           : yes 
Checking for header readline/history.h                                            : yes 
Checking for variable rl_event_hook                                               : ok 
Checking for variable program_invocation_short_name                               : ok 
Checking for declaration of snprintf                                              : ok 
Checking for declaration of vsnprintf                                             : ok 
Checking for declaration of asprintf                                              : ok 
Checking for declaration of vasprintf                                             : ok 
Checking for declaration of errno                                                 : ok 
Checking for declaration of EWOULDBLOCK                                           : ok 
Checking for declaration of environ                                               : ok 
Checking for declaration of getgrent_r                                            : ok 
Checking for declaration of getpwent_r                                            : ok 
Checking for declaration of pread                                                 : ok 
Checking for declaration of pwrite                                                : ok 
Checking for declaration of setenv                                                : ok 
Checking for declaration of setresgid                                             : ok 
Checking for declaration of setresuid                                             : ok 
Checking for eventfd                                                              : ok 
Checking for header poll.h                                                        : yes 
Checking for poll                                                                 : ok 
Checking for strptime                                                             : ok 
Checking for declaration of strptime                                              : ok 
Checking for working strptime                                                     : ok 
Checking for declaration of gettimeofday                                          : ok 
Checking C prototype for gettimeofday                                             : not found 
Checking C prototype for gettimeofday                                             : ok 
Checking for C99 vsnprintf                                                        : ok 
Checking for HAVE_SHARED_MMAP                                                     : ok 
Checking for HAVE_MREMAP                                                          : ok 
Checking for HAVE_INCOHERENT_MMAP                                                 : not found 
Checking for HAVE_IMMEDIATE_STRUCTURES                                            : ok 
Checking for HAVE_MKDIR_MODE                                                      : ok 
Checking for member st_rdev in struct stat                                        : ok 
Checking for member st_rdev in struct stat                                        : ok 
Checking for member ss_family in struct sockaddr_storage                          : ok 
Checking for member __ss_family in struct sockaddr_storage                        : not found 
Checking for member sa_len in struct sockaddr                                     : not found 
Checking for member sin_len in struct sockaddr_in                                 : not found 
Checking for member sin6_len in struct sockaddr_in6                               : not found 
Checking for HAVE_UNIXSOCKET                                                      : ok 
Checking for HAVE_SECURE_MKSTEMP                                                  : ok 
Checking for HAVE_IFACE_GETIFADDRS                                                : not found 
Checking for HAVE_IFACE_AIX                                                       : not found 
Checking for HAVE_IFACE_IFCONF                                                    : not found 
Checking for HAVE_IFACE_IFREQ                                                     : not found 
Checking for declaration of getpwent_r                                            : ok 
Checking C prototype for getpwent_r                                               : not found 
Checking for declaration of getgrent_r                                            : ok 
Checking C prototype for getgrent_r                                               : not found 
Checking C prototype for getpwent_r                                               : not found 
Checking C prototype for getgrent_r                                               : not found 
Checking for strerror_r                                                           : ok 
Checking for XSI (rather than GNU) prototype for strerror_r                       : not found 
Checking for program 'xsltproc'                                                   : not found 
Checking for header sys/auxv.h                                                    : yes 
Checking for getauxval                                                            : ok 
Checking if compiler accepts -fstack-protector-strong                             : yes 
Checking if compiler accepts -fstack-clash-protection                             : yes 
Checking linker accepts -Wl,-no-undefined                                         : yes 
Checking linker accepts ['-undefined', 'dynamic_lookup']                          : no 
Checking for program 'python3'                                                    : /usr/bin/python3 
Checking for program 'python'                                                     : /usr/bin/python3 
Checking for program 'python3'                                                    : /usr/bin/python3 
Checking for python version >= 3.6.0                                              : 3.10.12 
python-config                                                                     : /usr/bin/python3-config 
Asking python-config for pyembed '--cflags --libs --ldflags --embed' flags        : yes 
Testing pyembed configuration                                                     : yes 
Asking python-config for pyext '--cflags --libs --ldflags' flags                  : yes 
Testing pyext configuration                                                       : yes 
'configure' finished successfully (18.368s)
Восстанавливаем waf из https://waf.io/waf-2.0.25
--2025-05-24 06:03:10--  https://waf.io/waf-2.0.25
Resolving waf.io (waf.io)... 83.227.78.245
Connecting to waf.io (waf.io)|83.227.78.245|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 105631 (103K) [application/octet-stream]
Saving to: ‘waf’

     0K .......... .......... .......... .......... .......... 48%  354K 0s
    50K .......... .......... .......... .......... .......... 96%  356K 0s
   100K ...                                                   100% 5.88T=0.3s

2025-05-24 06:03:11 (366 KB/s) - ‘waf’ saved [105631/105631]

--2025-05-24 06:03:11--  https://waf.io/waflib-2.0.25.zip
Resolving waf.io (waf.io)... 83.227.78.245
Connecting to waf.io (waf.io)|83.227.78.245|:443... connected.
HTTP request sent, awaiting response... 404 Not Found
2025-05-24 06:03:12 ERROR 404: Not Found.

[waflib.zip]
  End-of-central-directory signature not found.  Either this file is not
  a zipfile, or it constitutes one disk of a multi-part archive.  In the
  latter case the central directory and zipfile comment will be found on
  the last disk(s) of this archive.
unzip:  cannot find zipfile directory in one of waflib.zip or
        waflib.zip.zip, and cannot find waflib.zip.ZIP, period.
Удаляем тестовые исходники и патчим wscript
Создаём папку install
Попытка сборки talloc 1...
Waf: The wscript in '/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2' is unreadable
Traceback (most recent call last):
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 102, in waf_entry_point
    set_main_module(wscript)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 142, in set_main_module
    Context.g_module=Context.load_module(file_path)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Context.py", line 362, in load_module
    exec(compile(code,path,'exec'),module.__dict__)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/wscript", line 98
    install=False)
                 ^
SyntaxError: unmatched ')'
Waf: The wscript in '/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2' is unreadable
Traceback (most recent call last):
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 102, in waf_entry_point
    set_main_module(wscript)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 142, in set_main_module
    Context.g_module=Context.load_module(file_path)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Context.py", line 362, in load_module
    exec(compile(code,path,'exec'),module.__dict__)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/wscript", line 98
    install=False)
                 ^
SyntaxError: unmatched ')'
Waf: The wscript in '/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2' is unreadable
Traceback (most recent call last):
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 102, in waf_entry_point
    set_main_module(wscript)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Scripting.py", line 142, in set_main_module
    Context.g_module=Context.load_module(file_path)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/.waf3-2.0.25-767522112be77f8585812fcfaa08e805/waflib/Context.py", line 362, in load_module
    exec(compile(code,path,'exec'),module.__dict__)
  File "/home/runner/work/boost-armv8-build/boost-armv8-build/talloc-2.4.2/wscript", line 98
    install=False)
                 ^
SyntaxError: unmatched ')'
talloc успешно собран!
  set -e
  tar -czvf talloc_android_arm64.tar.gz -C talloc-2.4.2/install .
  shell: /usr/bin/bash -e {0}
  env:
    ANDROID_NDK_HOME: /home/runner/android-ndk
    PATH: /home/runner/android-ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:/snap/bin:/home/runner/.local/bin:/opt/pipx_bin:/home/runner/.cargo/bin:/home/runner/.config/composer/vendor/bin:/usr/local/.ghcup/bin:/home/runner/.dotnet/tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
./
./include/
./lib/
=== make clean ===
fatal: No names found, cannot describe anything.
rm -f .check_process_vm.o .check_seccomp_filter.o .check_process_vm .check_seccomp_filter .check_process_vm.res .check_seccomp_filter.res cli/cli.o cli/proot.o cli/note.o execve/enter.o execve/exit.o execve/shebang.o execve/elf.o execve/ldso.o execve/auxv.o execve/aoxp.o path/binding.o path/glue.o path/canon.o path/path.o path/proc.o path/temp.o syscall/seccomp.o syscall/syscall.o syscall/chain.o syscall/enter.o syscall/exit.o syscall/sysnum.o syscall/socket.o syscall/heap.o syscall/rlimit.o tracee/tracee.o tracee/mem.o tracee/reg.o tracee/event.o ptrace/ptrace.o ptrace/user.o ptrace/wait.o extension/extension.o extension/kompat/kompat.o extension/fake_id0/fake_id0.o extension/link2symlink/link2symlink.o extension/portmap/portmap.o extension/portmap/map.o loader/loader-wrapped.o loader/loader-m32-wrapped.o extension/python/python.o extension/python/proot_wrap.o extension/python/python_extension.o extension/python/proot.o cli/care.o cli/care-manual.o extension/care/care.o extension/care/final.o extension/care/extract.o extension/care/archive.o loader/loader.o loader/assembly.o loader/loader-m32.o loader/assembly-m32.o proot care loader/loader loader/loader-m32 cli/care-manual.o cli/cli.d cli/proot.d cli/note.d execve/enter.d execve/exit.d execve/shebang.d execve/elf.d execve/ldso.d execve/auxv.d execve/aoxp.d path/binding.d path/glue.d path/canon.d path/path.d path/proc.d path/temp.d syscall/seccomp.d syscall/syscall.d syscall/chain.d syscall/enter.d syscall/exit.d syscall/sysnum.d syscall/socket.d syscall/heap.d syscall/rlimit.d tracee/tracee.d tracee/mem.d tracee/reg.d tracee/event.d ptrace/ptrace.d ptrace/user.d ptrace/wait.d extension/extension.d extension/kompat/kompat.d extension/fake_id0/fake_id0.d extension/link2symlink/link2symlink.d extension/portmap/portmap.d extension/portmap/map.d loader/loader-wrapped.d loader/loader-m32-wrapped.d extension/python/python.d extension/python/proot_wrap.d extension/python/python_extension.d extension/python/proot.d cli/care.d cli/care-manual.d extension/care/care.d extension/care/final.d extension/care/extract.d extension/care/archive.d loader/loader.d loader/assembly.d loader/loader-m32.d loader/assembly-m32.d .check_process_vm.d .check_seccomp_filter.d build.h licenses proot.py proot_wrap.c
Package talloc was not found in the pkg-config search path.
Perhaps you should add the directory containing `talloc.pc'
to the PKG_CONFIG_PATH environment variable
No package 'talloc' found
Package talloc was not found in the pkg-config search path.
Perhaps you should add the directory containing `talloc.pc'
to the PKG_CONFIG_PATH environment variable
No package 'talloc' found
=== make build ===
fatal: No names found, cannot describe anything.
./.check_process_vm.c:6:9: error: call to undeclared function 'process_vm_readv'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
        return process_vm_readv(0, NULL, 0, NULL, 0, 0)
               ^
./.check_process_vm.c:7:11: error: call to undeclared function 'process_vm_writev'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
               + process_vm_writev(0, NULL, 0, NULL, 0, 0);
                 ^
2 errors generated.
make: [GNUmakefile:144: .check_process_vm.o] Error 1 (ignored)
clang-17: error: no such file or directory: '.check_process_vm.o'
make: [GNUmakefile:147: .check_process_vm] Error 1 (ignored)
if [ -e .check_process_vm ]; then echo "#define HAVE_PROCESS_VM" > .check_process_vm.res; else echo "" > .check_process_vm.res; fi
ld.lld: error: unable to find library -ltalloc
clang-17: error: linker command failed with exit code 1 (use -v to see invocation)
make: [GNUmakefile:147: .check_seccomp_filter] Error 1 (ignored)
if [ -e .check_seccomp_filter ]; then echo "#define HAVE_SECCOMP_FILTER" > .check_seccomp_filter.res; else echo "" > .check_seccomp_filter.res; fi
echo "/* This file is auto-generated, edit at your own risk.  */" > build.h
echo "#ifndef BUILD_H"      >> build.h
echo "#define BUILD_H"      >> build.h
sh -c 'if [ ! -z "-50949de3" ]; then /bin/echo -e "#undef VERSION\n#define VERSION \"-50949de3\""; fi;'    >> build.h
sh -c '/bin/echo -e "#define HAVE_PYTHON_EXTENSION"'    >> build.h
cat .check_process_vm.res .check_seccomp_filter.res                      >> build.h
echo "#endif /* BUILD_H */" >> build.h
/home/runner/android-ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -I. -I./ -I.//../lib/uthash/include -I/usr/include/python3.10 -I/usr/include/python3.10 --target=aarch64-linux-android21 --sysroot=/home/runner/android-ndk/toolchains/llvm/prebuilt/linux-x86_64/sysroot -fPIC -I/home/runner/work/boost-armv8-build/boost-armv8-build/../talloc-2.4.2/install/include -DANDROID -Wno-deprecated-declarations -MD -c ./cli/cli.c -o cli/cli.o
./cli/cli.c:41:10: fatal error: 'talloc.h' file not found
#include <talloc.h>        /* talloc*,  */
         ^~~~~~~~~~
         /* -*- c-set-style: "K&R"; c-basic-offset: 8 -*-
#ifdef __ANDROID__
#include <string.h>
static char *basename(char *path) {
  char *last_slash;
  if (path == NULL || *path == '\0')
    return path;
  last_slash = strrchr(path, '/');
  if (last_slash != NULL)
    return last_slash + 1;
  return path;
}
#else
#include <libgen.h>
#endif
 *
 * This file is part of PRoot.
 *
 * Copyright (C) 2015 STMicroelectronics
 *